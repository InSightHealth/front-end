"use weex:vue";

if (typeof Promise !== 'undefined' && !Promise.prototype.finally) {
  Promise.prototype.finally = function(callback) {
    const promise = this.constructor
    return this.then(
      value => promise.resolve(callback()).then(() => value),
      reason => promise.resolve(callback()).then(() => {
        throw reason
      })
    )
  }
};

if (typeof uni !== 'undefined' && uni && uni.requireGlobal) {
  const global = uni.requireGlobal()
  ArrayBuffer = global.ArrayBuffer
  Int8Array = global.Int8Array
  Uint8Array = global.Uint8Array
  Uint8ClampedArray = global.Uint8ClampedArray
  Int16Array = global.Int16Array
  Uint16Array = global.Uint16Array
  Int32Array = global.Int32Array
  Uint32Array = global.Uint32Array
  Float32Array = global.Float32Array
  Float64Array = global.Float64Array
  BigInt64Array = global.BigInt64Array
  BigUint64Array = global.BigUint64Array
};


(()=>{var C=Object.create;var x=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty;var A=(e,s)=>()=>(s||e((s={exports:{}}).exports,s),s.exports);var F=(e,s,a,r)=>{if(s&&typeof s=="object"||typeof s=="function")for(let o of P(s))!H.call(e,o)&&o!==a&&x(e,o,{get:()=>s[o],enumerable:!(r=I(s,o))||r.enumerable});return e};var b=(e,s,a)=>(a=e!=null?C(S(e)):{},F(s||!e||!e.__esModule?x(a,"default",{value:e,enumerable:!0}):a,e));var m=A((q,k)=>{k.exports=Vue});var E=b(m()),W=e=>typeof e=="string";function i(e,s,...a){uni.__log__?uni.__log__(e,s,...a):console[e].apply(console,[...a,s])}function v(e,s){return W(e)?s:e}var d=(e,s)=>{let a=e.__vccOpts||e;for(let[r,o]of s)a[r]=o;return a};var t=b(m()),T={"chat-body":{"":{display:"flex",flexDirection:"column",width:"750rpx",boxSizing:"content-box"}},self:{".chat-body ":{justifyContent:"flex-end"}},item:{".chat-body ":{width:"750rpx",display:"flex",paddingTop:"45rpx",paddingRight:"30rpx",paddingBottom:"45rpx",paddingLeft:"30rpx"}},right:{".chat-body .item ":{backgroundColor:"#ACEC9C",alignSelf:"flex-end"}},left:{".chat-body .item ":{backgroundColor:"#FFFFFF"}},"poly-right":{".chat-body .item ":{position:"relative",top:"-50rpx",left:"-5rpx",height:"30rpx",width:"30rpx",alignSelf:"flex-end"}},"poly-left":{".chat-body .item ":{position:"relative",top:"50rpx",left:"5rpx",height:"30rpx",width:"30rpx",alignSelf:"flex-start"}},content:{".chat-body .item ":{position:"relative",wordWrap:"break-word",paddingTop:"24rpx",paddingRight:"24rpx",paddingBottom:"24rpx",paddingLeft:"24rpx",marginTop:0,marginRight:"24rpx",marginBottom:0,marginLeft:"24rpx",borderRadius:"30rpx",fontSize:"32rpx",fontFamily:"PingFang SC",fontWeight:"500",color:"#333333",lineHeight:"42rpx",maxWidth:"380rpx"}},avatar:{".chat-body .item ":{display:"flex",alignItems:"center",justifyContent:"center",width:"115rpx",height:"115rpx",overflow:"hidden"}}},h=uni.createInnerAudioContext();h.autoplay=!1;h.src="";var R={name:"bot-chat",props:{msgList:{type:Array,default:[{botContent:"hello\uFF0C\u8BF7\u95EE\u6211\u6709\u4EC0\u4E48\u53EF\u4EE5\u5E2E\u52A9\u4F60\u7684\u5417\uFF1F",recordId:0,titleId:0,userContent:"",userId:0}]}},data(){return{userId:"",chatMsg:"",randstr:"ksdafhaslihflksahfklksdafhaslihflksahfklksdafhaslihflksahfklksdafhaslihflksahfkl"}},methods:{play(e){let s=this.msgList[e].botContent,a=encodeURI(s);i("log","at components/cover-chat/cover-chat.vue:77",a),h.src=`https://tts.baidu.com/text2audio.mp3?lan=ZH&cuid=baike
					&spd=`+this.speed+"&ctp=1&amp&pdt=301&tex="+a,i("log","at components/cover-chat/cover-chat.vue:80",h.src),h.play(),i("log","at components/cover-chat/cover-chat.vue:82","play over!!!")}}};function U(e,s,a,r,o,c){return(0,t.openBlock)(),(0,t.createElementBlock)("view",{id:"msglistview",class:"chat-body",style:(0,t.normalizeStyle)({width:e.windowWidth}),renderWhole:!0},[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(a.msgList,(l,u)=>((0,t.openBlock)(),(0,t.createElementBlock)("view",{key:u,style:(0,t.normalizeStyle)({width:e.windowWidth})},[l.userContent!=""?((0,t.openBlock)(),(0,t.createElementBlock)("view",{key:0,class:"item self"},[(0,t.createElementVNode)("view",{class:"content right"},[(0,t.createElementVNode)("u-text",null,(0,t.toDisplayString)(l.userContent),1)]),(0,t.createElementVNode)("u-image",{class:"poly-right",src:"/static/travel/polygon-right.png"})])):(0,t.createCommentVNode)("",!0),l.botContent!=""?((0,t.openBlock)(),(0,t.createElementBlock)("view",{key:1,class:"item Ai"},[(0,t.createElementVNode)("u-image",{class:"poly-left",src:"/static/travel/polygon-left.png"}),(0,t.createElementVNode)("view",{class:"content left",onClick:_=>c.play(u)},[(0,t.createElementVNode)("u-text",null,(0,t.toDisplayString)(l.botContent),1)],8,["onClick"])])):(0,t.createCommentVNode)("",!0)],4))),128))],4)}var L=d(R,[["render",U],["styles",[T]]]),M={mic:{"":{width:"130rpx",height:"130rpx"}}},f=uni.getRecorderManager(),D=uni.createInnerAudioContext();D.autoplay=!0;var $={data(){return{text:"uni-app",voicePath:""}},methods:{startRecord(){i("log","at components/micphone/micphone.vue:20","\u5F00\u59CB\u5F55\u97F3"),f.start()},endRecord(){let e="";return i("log","at components/micphone/micphone.vue:25","\u5F55\u97F3\u7ED3\u675F"),f.stop(),f.onStop(function(s){this.voicePath=s.tempFilePath}),i("log","at components/micphone/micphone.vue:41","tmpfPath = "+this.voicePath),e}}};function z(e,s,a,r,o,c){return(0,t.openBlock)(),(0,t.createElementBlock)("u-image",{src:"https://img-insight.oss-cn-chengdu.aliyuncs.com/micphone/mic1.png",class:"mic"})}var B=d($,[["render",z],["styles",[M]]]),N={"pengke-camera":{"":{justifyContent:"center",alignItems:"center"}},chat:{".pengke-camera ":{position:"absolute",left:0,bottom:0,zIndex:98,alignItems:"center",justifyContent:"center"}},coverchat:{".pengke-camera .chat ":{zIndex:99,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between"}},"scroll-view":{".pengke-camera .chat .coverchat ":{height:100,width:"750rpx"}},"mic-container":{".pengke-camera .chat .coverchat ":{height:"200rpx",width:"200rpx",display:"flex",alignItems:"center",justifyContent:"center"}}},n=null,w=uni.getRecorderManager(),p=uni.createInnerAudioContext(),j={data(){return{poenCarmeInterval:null,aspect:"2:3",windowWidth:"",windowHeight:"",camerastate:!1,livePusher:null,snapshotsrc:null,msglist:[{botContent:"hello\uFF0C\u8BF7\u95EE\u6211\u6709\u4EC0\u4E48\u53EF\u4EE5\u5E2E\u52A9\u4F60\u7684\u5417\uFF1F",recordId:0,titleId:0,userContent:"",userId:0}],randstr:"ksdafhaslihflksahfklksdafhaslihflksahfklksdafhaslihflksahfklksdafhaslihflksahfkl",micScale:1,backUrl:"",baseUrl:"",token:""}},onLoad(e){n=this,this.token=getApp().getToken(),this.backUrl=getApp().globalData.backUrl,this.baseUrl=getApp().globalData.baseUrl,this.initCamera()},onUnload(){uni.offKeyboardHeightChange()},onReady(){this.livePusher=uni.createLivePusherContext("livePusher",this),this.startPreview(),this.poenCarme()},methods:{poenCarme(){plus.os.name=="Android"&&(this.poenCarmeInterval=setInterval(function(){n.camerastate||n.startPreview()},2500))},initCamera(){uni.getSystemInfo({success:function(e){n.windowWidth=e.windowWidth,n.windowHeight=e.windowHeight;let s=n.aliquot(n.windowWidth,n.windowHeight);n.aspect=n.windowWidth/s+":"+n.windowHeight/s}})},aliquot(e,s){return e%s==0?s:this.aliquot(s,e%s)},startPreview(){this.livePusher.startPreview({success:e=>{i("log","at pages/smart-travel/cover_nvue.nvue:131",e)}})},stopPreview(){this.livePusher.stopPreview({success:e=>{n.camerastate=!1}})},statechange(e){e.detail.code==1007?n.camerastate=!0:e.detail.code==-1301&&(n.camerastate=!1)},back(){uni.navigateBack()},snapshot(){uni.vibrateShort({success:function(){i("log","at pages/smart-travel/cover_nvue.nvue:167","success")}}),this.livePusher.snapshot({success:e=>{n.snapshotsrc=e.message.tempImagePath,this.snapshotsrc=e.message.tempImagePath}})},setImage(){let e=getCurrentPages();e[e.length-2].$vm.setImage({path:n.snapshotsrc})},startMic(){i("log","at pages/smart-travel/cover_nvue.nvue:187","\u5F00\u59CB\u5F55\u97F3"),w.start(),this.micScale=1.3},stopMic(){i("log","at pages/smart-travel/cover_nvue.nvue:193","\u5F55\u97F3\u7ED3\u675F");let e=this.baseUrl+"/speechtotext";w.stop(),this.micScale=1,i("log","at pages/smart-travel/cover_nvue.nvue:197",""),w.onStop(function(s){uni.uploadFile({url:e,name:"mp3",filePath:s.tempFilePath,formData:{},success:a=>{i("log","at pages/smart-travel/cover_nvue.nvue:205","\u4E0A\u4F20\u6210\u529F\uFF1A"+JSON.stringify(a));let r=JSON.parse(a.data);a.statusCode==200&&(n.msglist.push({botContent:"",recordId:0,titleId:0,userContent:r.text,userId:0}),n.msglist.push({botContent:"\u53D1\u9001\u4E2D...",recordId:0,titleId:0,userContent:"",userId:0}),n.handleRecord(r.text))},fail:a=>{i("error","at pages/smart-travel/cover_nvue.nvue:227","\u4E0A\u4F20\u5F55\u97F3\u5931\u8D25\uFF1A"+a.errMsg)}})})},handleRecord(e){this.livePusher.snapshot({success:s=>{n.snapshotsrc=s.message.tempImagePath,i("log","at pages/smart-travel/cover_nvue.nvue:236","_this.snapshotsrc = "+n.snapshotsrc),uni.uploadFile({url:this.backUrl+"/storage/api/v1/uploadImg/move",filePath:n.snapshotsrc,name:"multipartFile",formData:{},header:{token:this.token},success:a=>{i("log","at pages/smart-travel/cover_nvue.nvue:246",a.data);let r=JSON.parse(a.data);r.code==200&&(i("log","at pages/smart-travel/cover_nvue.nvue:249",r.data),n.sendChat(e,r.data.image))},fail:a=>{i("log","at pages/smart-travel/cover_nvue.nvue:253",a.errMsg)}})}})},sendChat(e,s){i("log","at pages/smart-travel/cover_nvue.nvue:261","text = "+e+"   imgUrl = "+s),uni.request({url:this.baseUrl+"/chatbot",method:"POST",data:{prompt:e,image:s},success:a=>{i("log","at pages/smart-travel/cover_nvue.nvue:270",a),n.msglist.pop();try{let r=a.data;n.msglist.push({botContent:r.response,recordId:0,titleId:0,userContent:"",userId:0});let o=encodeURI(r.response);i("log","at pages/smart-travel/cover_nvue.nvue:283",o),p.src="https://tts.baidu.com/text2audio.mp3?lan=ZH&cuid=baike&spd=5&ctp=1&amp&pdt=301&tex="+o,p.play()}catch(r){n.msglist.push({botContent:"\u53D1\u9001\u5931\u8D25",recordId:0,titleId:0,userContent:"",userId:0});let o=encodeURI("\u53D1\u9001\u5931\u8D25");i("log","at pages/smart-travel/cover_nvue.nvue:295",o),p.src="https://tts.baidu.com/text2audio.mp3?lan=ZH&cuid=baike&spd=5&ctp=1&amp&pdt=301&tex="+o,p.play()}},fail:a=>{i("log","at pages/smart-travel/cover_nvue.nvue:301",a),n.msglist.pop(),n.msglist.push({botContent:"\u53D1\u9001\u5931\u8D25",recordId:0,titleId:0,userContent:"",userId:0});let r=encodeURI("\u53D1\u9001\u5931\u8D25");i("log","at pages/smart-travel/cover_nvue.nvue:311",r),p.src="https://tts.baidu.com/text2audio.mp3?lan=ZH&cuid=baike&spd=5&ctp=1&amp&pdt=301&tex="+r,p.play()}})}}};function O(e,s,a,r,o,c){let l=v((0,t.resolveDynamicComponent)("cover-chat"),L),u=v((0,t.resolveDynamicComponent)("micphone"),B);return(0,t.openBlock)(),(0,t.createElementBlock)("scroll-view",{scrollY:!0,showScrollbar:!0,enableBackToTop:!0,bubble:"true",style:{flexDirection:"column"}},[(0,t.createElementVNode)("view",{class:"pengke-camera",style:(0,t.normalizeStyle)({width:o.windowWidth,height:o.windowHeight})},[(0,t.createElementVNode)("live-pusher",{id:"livePusher",ref:"livePusher",class:"livePusher",mode:"FHD",beauty:"0",whiteness:"0",aspect:o.aspect,minBitrate:"1000",audioQuality:"16KHz",devicePosition:"back",autoFocus:!0,muted:!0,enableCamera:!0,enableMic:!1,zoom:!1,onStatechange:s[0]||(s[0]=(..._)=>c.statechange&&c.statechange(..._)),style:(0,t.normalizeStyle)({width:o.windowWidth,height:o.windowHeight})},null,44,["aspect"]),(0,t.createElementVNode)("view",{class:"chat",style:(0,t.normalizeStyle)({width:o.windowWidth,height:o.windowHeight})},[(0,t.createElementVNode)("cover-view",{class:"coverchat",style:(0,t.normalizeStyle)({width:o.windowWidth,height:o.windowHeight})},[(0,t.createElementVNode)("scroll-view",{style:(0,t.normalizeStyle)({height:`${o.windowHeight*.8}px`}),id:"scrollview",scrollY:"true",scrollTop:e.scrollTop,class:"scroll-view",enableFlex:"true"},[(0,t.createVNode)(l,{msgList:o.msglist},null,8,["msgList"])],12,["scrollTop"]),(0,t.createElementVNode)("cover-view",{class:"mic-container",style:(0,t.normalizeStyle)({height:`${o.windowHeight*.2}px`})},[(0,t.createVNode)(u,{ref:"micphone",onTouchstart:c.startMic,onTouchend:c.stopMic,style:(0,t.normalizeStyle)({transform:`scale(${o.micScale})`})},null,8,["onTouchstart","onTouchend","style"])],4)],4)],4)],4)])}var g=d(j,[["render",O],["styles",[N]]]);var y=plus.webview.currentWebview();if(y){let e=parseInt(y.id),s="pages/smart-travel/cover_nvue",a={};try{a=JSON.parse(y.__query__)}catch(o){}g.mpType="page";let r=Vue.createPageApp(g,{$store:getApp({allowDefault:!0}).$store,__pageId:e,__pagePath:s,__pageQuery:a});r.provide("__globalStyles",Vue.useCssStyles([...__uniConfig.styles,...g.styles||[]])),r.mount("#root")}})();
