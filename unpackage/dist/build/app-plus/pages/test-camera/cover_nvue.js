"use weex:vue";

if (typeof Promise !== 'undefined' && !Promise.prototype.finally) {
  Promise.prototype.finally = function(callback) {
    const promise = this.constructor
    return this.then(
      value => promise.resolve(callback()).then(() => value),
      reason => promise.resolve(callback()).then(() => {
        throw reason
      })
    )
  }
};

if (typeof uni !== 'undefined' && uni && uni.requireGlobal) {
  const global = uni.requireGlobal()
  ArrayBuffer = global.ArrayBuffer
  Int8Array = global.Int8Array
  Uint8Array = global.Uint8Array
  Uint8ClampedArray = global.Uint8ClampedArray
  Int16Array = global.Int16Array
  Uint16Array = global.Uint16Array
  Int32Array = global.Int32Array
  Uint32Array = global.Uint32Array
  Float32Array = global.Float32Array
  Float64Array = global.Float64Array
  BigInt64Array = global.BigInt64Array
  BigUint64Array = global.BigUint64Array
};


(()=>{var k=Object.create;var x=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty;var A=(e,s)=>()=>(s||e((s={exports:{}}).exports,s),s.exports);var F=(e,s,a,i)=>{if(s&&typeof s=="object"||typeof s=="function")for(let o of P(s))!H.call(e,o)&&o!==a&&x(e,o,{get:()=>s[o],enumerable:!(i=I(s,o))||i.enumerable});return e};var b=(e,s,a)=>(a=e!=null?k(S(e)):{},F(s||!e||!e.__esModule?x(a,"default",{value:e,enumerable:!0}):a,e));var m=A((E,C)=>{C.exports=Vue});var J=b(m()),W=e=>typeof e=="string";function r(e,s,...a){uni.__log__?uni.__log__(e,s,...a):console[e].apply(console,[...a,s])}function v(e,s){return W(e)?s:e}var d=(e,s)=>{let a=e.__vccOpts||e;for(let[i,o]of s)a[i]=o;return a};var t=b(m()),R={"chat-body":{"":{display:"flex",flexDirection:"column",width:"750rpx",boxSizing:"content-box"}},self:{".chat-body ":{justifyContent:"flex-end"}},item:{".chat-body ":{width:"750rpx",display:"flex",paddingTop:"45rpx",paddingRight:"30rpx",paddingBottom:"45rpx",paddingLeft:"30rpx"}},right:{".chat-body .item ":{backgroundColor:"#ACEC9C",alignSelf:"flex-end"}},left:{".chat-body .item ":{backgroundColor:"#FFFFFF"}},"poly-right":{".chat-body .item ":{position:"relative",top:"-50rpx",left:"-5rpx",height:"30rpx",width:"30rpx",alignSelf:"flex-end"}},"poly-left":{".chat-body .item ":{position:"relative",top:"50rpx",left:"5rpx",height:"30rpx",width:"30rpx",alignSelf:"flex-start"}},content:{".chat-body .item ":{position:"relative",wordWrap:"break-word",paddingTop:"24rpx",paddingRight:"24rpx",paddingBottom:"24rpx",paddingLeft:"24rpx",marginTop:0,marginRight:"24rpx",marginBottom:0,marginLeft:"24rpx",borderRadius:"30rpx",fontSize:"32rpx",fontFamily:"PingFang SC",fontWeight:"500",color:"#333333",lineHeight:"42rpx",maxWidth:"380rpx"}},avatar:{".chat-body .item ":{display:"flex",alignItems:"center",justifyContent:"center",width:"115rpx",height:"115rpx",overflow:"hidden"}}},h=uni.createInnerAudioContext();h.autoplay=!1;h.src="";var T={name:"bot-chat",props:{msgList:{type:Array,default:[{botContent:"hello\uFF0C\u8BF7\u95EE\u6211\u6709\u4EC0\u4E48\u53EF\u4EE5\u5E2E\u52A9\u4F60\u7684\u5417\uFF1F",recordId:0,titleId:0,userContent:"",userId:0}]}},data(){return{userId:"",chatMsg:"",randstr:"ksdafhaslihflksahfklksdafhaslihflksahfklksdafhaslihflksahfklksdafhaslihflksahfkl"}},methods:{play(e){let s=this.msgList[e].botContent,a=encodeURI(s);r("log","at components/cover-chat/cover-chat.vue:77",a),h.src=`https://tts.baidu.com/text2audio.mp3?lan=ZH&cuid=baike
					&spd=`+this.speed+"&ctp=1&amp&pdt=301&tex="+a,r("log","at components/cover-chat/cover-chat.vue:80",h.src),h.play(),r("log","at components/cover-chat/cover-chat.vue:82","play over!!!")}}};function L(e,s,a,i,o,c){return(0,t.openBlock)(),(0,t.createElementBlock)("view",{id:"msglistview",class:"chat-body",style:(0,t.normalizeStyle)({width:e.windowWidth}),renderWhole:!0},[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(a.msgList,(l,u)=>((0,t.openBlock)(),(0,t.createElementBlock)("view",{key:u,style:(0,t.normalizeStyle)({width:e.windowWidth})},[l.userContent!=""?((0,t.openBlock)(),(0,t.createElementBlock)("view",{key:0,class:"item self"},[(0,t.createElementVNode)("view",{class:"content right"},[(0,t.createElementVNode)("u-text",null,(0,t.toDisplayString)(l.userContent),1)]),(0,t.createElementVNode)("u-image",{class:"poly-right",src:"/static/travel/polygon-right.png"})])):(0,t.createCommentVNode)("",!0),l.botContent!=""?((0,t.openBlock)(),(0,t.createElementBlock)("view",{key:1,class:"item Ai"},[(0,t.createElementVNode)("u-image",{class:"poly-left",src:"/static/travel/polygon-left.png"}),(0,t.createElementVNode)("view",{class:"content left",onClick:_=>c.play(u)},[(0,t.createElementVNode)("u-text",null,(0,t.toDisplayString)(l.botContent),1)],8,["onClick"])])):(0,t.createCommentVNode)("",!0)],4))),128))],4)}var M=d(T,[["render",L],["styles",[R]]]),D={mic:{"":{width:"130rpx",height:"130rpx"}}},f=uni.getRecorderManager(),$=uni.createInnerAudioContext();$.autoplay=!0;var z={data(){return{text:"uni-app",voicePath:""}},methods:{startRecord(){r("log","at components/micphone/micphone.vue:20","\u5F00\u59CB\u5F55\u97F3"),f.start()},endRecord(){let e="";return r("log","at components/micphone/micphone.vue:25","\u5F55\u97F3\u7ED3\u675F"),f.stop(),f.onStop(function(s){this.voicePath=s.tempFilePath}),r("log","at components/micphone/micphone.vue:41","tmpfPath = "+this.voicePath),e}}};function B(e,s,a,i,o,c){return(0,t.openBlock)(),(0,t.createElementBlock)("u-image",{src:"https://img-insight.oss-cn-chengdu.aliyuncs.com/micphone/mic1.png",class:"mic"})}var N=d(z,[["render",B],["styles",[D]]]),O={"pengke-camera":{"":{justifyContent:"center",alignItems:"center"}},chat:{".pengke-camera ":{position:"absolute",left:0,bottom:0,zIndex:98,alignItems:"center",justifyContent:"center"}},coverchat:{".pengke-camera .chat ":{zIndex:99,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between"}},"scroll-view":{".pengke-camera .chat .coverchat ":{height:100,width:"750rpx"}},"mic-container":{".pengke-camera .chat .coverchat ":{height:"200rpx",width:"200rpx",display:"flex",alignItems:"center",justifyContent:"center"}}},n=null,w=uni.getRecorderManager(),p=uni.createInnerAudioContext(),j={data(){return{poenCarmeInterval:null,aspect:"2:3",windowWidth:"",windowHeight:"",camerastate:!1,livePusher:null,snapshotsrc:null,msglist:[{botContent:"hello\uFF0C\u8BF7\u95EE\u6211\u6709\u4EC0\u4E48\u53EF\u4EE5\u5E2E\u52A9\u4F60\u7684\u5417\uFF1F",recordId:0,titleId:0,userContent:"",userId:0}],randstr:"ksdafhaslihflksahfklksdafhaslihflksahfklksdafhaslihflksahfklksdafhaslihflksahfkl",micScale:1}},onLoad(e){n=this,this.initCamera()},onUnload(){uni.offKeyboardHeightChange()},onReady(){this.livePusher=uni.createLivePusherContext("livePusher",this),this.startPreview(),this.poenCarme()},methods:{poenCarme(){plus.os.name=="Android"&&(this.poenCarmeInterval=setInterval(function(){n.camerastate||n.startPreview()},2500))},initCamera(){uni.getSystemInfo({success:function(e){n.windowWidth=e.windowWidth,n.windowHeight=e.windowHeight;let s=n.aliquot(n.windowWidth,n.windowHeight);n.aspect=n.windowWidth/s+":"+n.windowHeight/s}})},aliquot(e,s){return e%s==0?s:this.aliquot(s,e%s)},startPreview(){this.livePusher.startPreview({success:e=>{r("log","at pages/test-camera/cover_nvue.nvue:125",e)}})},stopPreview(){this.livePusher.stopPreview({success:e=>{n.camerastate=!1}})},statechange(e){e.detail.code==1007?n.camerastate=!0:e.detail.code==-1301&&(n.camerastate=!1)},back(){uni.navigateBack()},snapshot(){uni.vibrateShort({success:function(){r("log","at pages/test-camera/cover_nvue.nvue:161","success")}}),this.livePusher.snapshot({success:e=>{n.snapshotsrc=e.message.tempImagePath,this.snapshotsrc=e.message.tempImagePath}})},setImage(){let e=getCurrentPages();e[e.length-2].$vm.setImage({path:n.snapshotsrc})},startMic(){r("log","at pages/test-camera/cover_nvue.nvue:181","\u5F00\u59CB\u5F55\u97F3"),w.start(),this.micScale=1.3},stopMic(){r("log","at pages/test-camera/cover_nvue.nvue:187","\u5F55\u97F3\u7ED3\u675F"),w.stop(),this.micScale=1,w.onStop(function(e){uni.uploadFile({url:"http://127.0.0.1:8000/speechtotext",name:"mp3",filePath:e.tempFilePath,formData:{},success:s=>{r("log","at pages/test-camera/cover_nvue.nvue:197","\u4E0A\u4F20\u6210\u529F\uFF1A"+JSON.stringify(s));let a=JSON.parse(s.data);s.statusCode==200&&(n.msglist.push({botContent:"",recordId:0,titleId:0,userContent:a.text,userId:0}),n.msglist.push({botContent:"\u53D1\u9001\u4E2D...",recordId:0,titleId:0,userContent:"",userId:0}),n.handleRecord(a.text))},fail:s=>{r("error","at pages/test-camera/cover_nvue.nvue:219","\u4E0A\u4F20\u5F55\u97F3\u5931\u8D25\uFF1A"+s.errMsg)}})})},handleRecord(e){this.livePusher.snapshot({success:s=>{n.snapshotsrc=s.message.tempImagePath;let a=getApp().globalData.token;r("log","at pages/test-camera/cover_nvue.nvue:229","_this.snapshotsrc = "+n.snapshotsrc),r("log","at pages/test-camera/cover_nvue.nvue:230","token = "+a),uni.uploadFile({url:"http://82.157.124.83:51603/storage/api/v1/uploadImg/move",filePath:n.snapshotsrc,name:"multipartFile",formData:{},header:{token:a},success:i=>{r("log","at pages/test-camera/cover_nvue.nvue:240",i.data);let o=JSON.parse(i.data);o.code==200&&(r("log","at pages/test-camera/cover_nvue.nvue:243",o.data),n.sendChat(e,o.data.image))},fail:i=>{r("log","at pages/test-camera/cover_nvue.nvue:247",i.errMsg)}})}})},sendChat(e,s){r("log","at pages/test-camera/cover_nvue.nvue:255","text = "+e+"   imgUrl = "+s),uni.request({url:"http://127.0.0.1:8000/chatbot",method:"POST",data:{prompt:e,image:s},success:a=>{r("log","at pages/test-camera/cover_nvue.nvue:264",a),n.msglist.pop();try{let i=JSON.parse(a.data);n.msglist.push({botContent:i.response,recordId:0,titleId:0,userContent:"",userId:0});let o=encodeURI(i.response);r("log","at pages/test-camera/cover_nvue.nvue:277",o),p.src="https://tts.baidu.com/text2audio.mp3?lan=ZH&cuid=baike&spd=5&ctp=1&amp&pdt=301&tex="+o,p.play()}catch(i){n.msglist.push({botContent:"\u53D1\u9001\u5931\u8D25",recordId:0,titleId:0,userContent:"",userId:0});let o=encodeURI("\u53D1\u9001\u5931\u8D25");r("log","at pages/test-camera/cover_nvue.nvue:289",o),p.src="https://tts.baidu.com/text2audio.mp3?lan=ZH&cuid=baike&spd=5&ctp=1&amp&pdt=301&tex="+o,p.play()}},fail:a=>{r("log","at pages/test-camera/cover_nvue.nvue:295",a),n.msglist.pop(),n.msglist.push({botContent:"\u53D1\u9001\u5931\u8D25",recordId:0,titleId:0,userContent:"",userId:0});let i=encodeURI("\u53D1\u9001\u5931\u8D25");r("log","at pages/test-camera/cover_nvue.nvue:305",i),p.src="https://tts.baidu.com/text2audio.mp3?lan=ZH&cuid=baike&spd=5&ctp=1&amp&pdt=301&tex="+i,p.play()}})}}};function V(e,s,a,i,o,c){let l=v((0,t.resolveDynamicComponent)("cover-chat"),M),u=v((0,t.resolveDynamicComponent)("micphone"),N);return(0,t.openBlock)(),(0,t.createElementBlock)("scroll-view",{scrollY:!0,showScrollbar:!0,enableBackToTop:!0,bubble:"true",style:{flexDirection:"column"}},[(0,t.createElementVNode)("view",{class:"pengke-camera",style:(0,t.normalizeStyle)({width:o.windowWidth,height:o.windowHeight})},[(0,t.createElementVNode)("live-pusher",{id:"livePusher",ref:"livePusher",class:"livePusher",mode:"FHD",beauty:"0",whiteness:"0",aspect:o.aspect,minBitrate:"1000",audioQuality:"16KHz",devicePosition:"back",autoFocus:!0,muted:!0,enableCamera:!0,enableMic:!1,zoom:!1,onStatechange:s[0]||(s[0]=(..._)=>c.statechange&&c.statechange(..._)),style:(0,t.normalizeStyle)({width:o.windowWidth,height:o.windowHeight})},null,44,["aspect"]),(0,t.createElementVNode)("view",{class:"chat",style:(0,t.normalizeStyle)({width:o.windowWidth,height:o.windowHeight})},[(0,t.createElementVNode)("cover-view",{class:"coverchat",style:(0,t.normalizeStyle)({width:o.windowWidth,height:o.windowHeight})},[(0,t.createElementVNode)("scroll-view",{style:(0,t.normalizeStyle)({height:`${o.windowHeight*.8}px`}),id:"scrollview",scrollY:"true",scrollTop:e.scrollTop,class:"scroll-view",enableFlex:"true"},[(0,t.createVNode)(l,{msgList:o.msglist},null,8,["msgList"])],12,["scrollTop"]),(0,t.createElementVNode)("cover-view",{class:"mic-container",style:(0,t.normalizeStyle)({height:`${o.windowHeight*.2}px`})},[(0,t.createVNode)(u,{ref:"micphone",onTouchstart:c.startMic,onTouchend:c.stopMic,style:(0,t.normalizeStyle)({transform:`scale(${o.micScale})`})},null,8,["onTouchstart","onTouchend","style"])],4)],4)],4)],4)])}var g=d(j,[["render",V],["styles",[O]]]);var y=plus.webview.currentWebview();if(y){let e=parseInt(y.id),s="pages/test-camera/cover_nvue",a={};try{a=JSON.parse(y.__query__)}catch(o){}g.mpType="page";let i=Vue.createPageApp(g,{$store:getApp({allowDefault:!0}).$store,__pageId:e,__pagePath:s,__pageQuery:a});i.provide("__globalStyles",Vue.useCssStyles([...__uniConfig.styles,...g.styles||[]])),i.mount("#root")}})();
