"use weex:vue";

if (typeof Promise !== 'undefined' && !Promise.prototype.finally) {
  Promise.prototype.finally = function(callback) {
    const promise = this.constructor
    return this.then(
      value => promise.resolve(callback()).then(() => value),
      reason => promise.resolve(callback()).then(() => {
        throw reason
      })
    )
  }
};

if (typeof uni !== 'undefined' && uni && uni.requireGlobal) {
  const global = uni.requireGlobal()
  ArrayBuffer = global.ArrayBuffer
  Int8Array = global.Int8Array
  Uint8Array = global.Uint8Array
  Uint8ClampedArray = global.Uint8ClampedArray
  Int16Array = global.Int16Array
  Uint16Array = global.Uint16Array
  Int32Array = global.Int32Array
  Uint32Array = global.Uint32Array
  Float32Array = global.Float32Array
  Float64Array = global.Float64Array
  BigInt64Array = global.BigInt64Array
  BigUint64Array = global.BigUint64Array
};


(()=>{var _=Object.create;var w=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var I=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var P=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var T=(e,t,r,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of C(t))!S.call(e,n)&&n!==r&&w(e,n,{get:()=>t[n],enumerable:!(c=x(t,n))||c.enumerable});return e};var v=(e,t,r)=>(r=e!=null?_(I(e)):{},T(t||!e||!e.__esModule?w(r,"default",{value:e,enumerable:!0}):r,e));var p=P((M,b)=>{b.exports=Vue});var O=v(p()),H=e=>typeof e=="string";function a(e,t,...r){uni.__log__?uni.__log__(e,t,...r):console[e].apply(console,[...r,t])}function g(e,t){return H(e)?t:e}var h=(e,t)=>{let r=e.__vccOpts||e;for(let[c,n]of t)r[c]=n;return r};var o=v(p()),F={mic:{"":{width:"100rpx",height:"100rpx"}}},m=uni.getRecorderManager(),W=uni.createInnerAudioContext();W.autoplay=!0;var k={data(){return{text:"uni-app",voicePath:""}},methods:{startRecord(){a("log","at components/micphone/micphone.vue:20","\u5F00\u59CB\u5F55\u97F3"),m.start()},endRecord(){a("log","at components/micphone/micphone.vue:24","\u5F55\u97F3\u7ED3\u675F"),m.stop(),m.onStop(function(e){a("log","at components/micphone/micphone.vue:27",JSON.stringify(e)),uni.uploadFile({url:"http://127.0.0.1:8000/speechtotext",filePath:e.tempFilePath,name:"mp3",formData:{},success:t=>{a("log","at components/micphone/micphone.vue:34","\u4E0A\u4F20\u6210\u529F\uFF1A"+JSON.stringify(t))},fail:t=>{a("error","at components/micphone/micphone.vue:36","\u4E0A\u4F20\u5F55\u97F3\u5931\u8D25\uFF1A"+t)}})})}}};function R(e,t,r,c,n,s){return(0,o.openBlock)(),(0,o.createElementBlock)("u-image",{onTouchstart:t[0]||(t[0]=(...l)=>s.startRecord&&s.startRecord(...l)),onTouchend:t[1]||(t[1]=(...l)=>s.endRecord&&s.endRecord(...l)),src:"https://img-insight.oss-cn-chengdu.aliyuncs.com/micphone/mic1.png",class:"mic"},null,32)}var B=h(k,[["render",R],["styles",[F]]]),L={"scroll-view":{".chat ":{width:"750rpx"}},"chat-body":{".chat .scroll-view ":{display:"flex",width:"750rpx",flexDirection:"column",paddingTop:"23rpx"}},self:{".chat .scroll-view .chat-body ":{justifyContent:"flex-end"}},item:{".chat .scroll-view .chat-body ":{display:"flex",paddingTop:"23rpx",paddingRight:"5rpx",paddingBottom:"23rpx",paddingLeft:"5rpx",width:"750rpx"}},right:{".chat .scroll-view .chat-body .item ":{backgroundColor:"#ACEC9C","position::after":"absolute","content::after":'""',"width::after":0,"height::after":0,"left::after":100,"top::after":10,"borderWidth::after":"12rpx","borderStyle::after":"solid","borderColor::after":"rgba(0,0,0,0)","borderLeftWidth::after":"15rpx","borderLeftStyle::after":"solid","borderLeftColor::after":"#ACEC9C","transform::after":"translate(-4rpx)"}},left:{".chat .scroll-view .chat-body .item ":{backgroundColor:"#FFFFFF","position::after":"absolute","content::after":'""',"width::after":0,"height::after":0,"top::after":10,"right::after":100,"borderWidth::after":"12rpx","borderStyle::after":"solid","borderColor::after":"rgba(0,0,0,0)","borderRightWidth::after":"15rpx","borderRightStyle::after":"solid","borderRightColor::after":"#FFFFFF","transform::after":"translate(4rpx)"}},content:{".chat .scroll-view .chat-body .item ":{position:"relative",maxWidth:"450rpx",borderRadius:12,wordWrap:"break-word",paddingTop:"10rpx",paddingRight:"20rpx",paddingBottom:"10rpx",paddingLeft:"20rpx",marginTop:0,marginRight:"24rpx",marginBottom:0,marginLeft:"24rpx",fontSize:"20rpx",fontFamily:"PingFang SC",fontWeight:"500",color:"#333333",lineHeight:"32rpx"}},"chat-bottom":{".chat ":{width:"750rpx",height:"177rpx",paddingBottom:"20rpx",transitionDuration:100,transitionTimingFunction:"ease",display:"flex",justifyContent:"center",alignItems:"center"}},"@TRANSITION":{"chat-bottom":{duration:100,timingFunction:"ease"}}},A={data(){return{keyboardHeight:0,bottomHeight:0,scrollTop:0,userId:"",chatMsg:"",msgList:[{botContent:"\u6309\u4F4F\u5C4F\u5E55\u4E0B\u65B9\u6309\u94AE\u8BB2\u8BDD",recordId:0,titleId:0,userContent:"",userId:0},{botContent:"",recordId:0,titleId:0,userContent:"\u6211\u7684\u524D\u9762\u6709\u4EC0\u4E48\uFF1F",userId:0},{userContent:"",recordId:0,titleId:0,botContent:"\u60A8\u7684\u6B63\u524D\u65B9\u6709\u4E00\u4E2A\u6307\u793A\u724C\uFF0C\u8BF7\u6CE8\u610F\u5B89\u5168",userId:0},{botContent:"",recordId:0,titleId:0,userContent:"\u6211\u7684\u524D\u9762\u6709\u4EC0\u4E48\uFF1F",userId:0},{userContent:"",recordId:0,titleId:0,botContent:"\u60A8\u7684\u6B63\u524D\u65B9\u6709\u4E00\u4E2A\u6307\u793A\u724C\uFF0C\u8BF7\u6CE8\u610F\u5B89\u5168",userId:0},{botContent:"",recordId:0,titleId:0,userContent:"\u6211\u7684\u524D\u9762\u6709\u4EC0\u4E48\uFF1F",userId:0},{userContent:"",recordId:0,titleId:0,botContent:"\u60A8\u7684\u6B63\u524D\u65B9\u6709\u4E00\u4E2A\u6307\u793A\u724C\uFF0C\u8BF7\u6CE8\u610F\u5B89\u5168",userId:0},{botContent:"",recordId:0,titleId:0,userContent:"\u6211\u7684\u524D\u9762\u6709\u4EC0\u4E48\uFF1F",userId:0},{userContent:"",recordId:0,titleId:0,botContent:"\u60A8\u7684\u6B63\u524D\u65B9\u6709\u4E00\u4E2A\u6307\u793A\u724C\uFF0C\u8BF7\u6CE8\u610F\u5B89\u5168",userId:0},{botContent:"",recordId:0,titleId:0,userContent:"\u6211\u7684\u524D\u9762\u6709\u4EC0\u4E48\uFF1F",userId:0},{userContent:"",recordId:0,titleId:0,botContent:"\u60A8\u7684\u6B63\u524D\u65B9\u6709\u4E00\u4E2A\u6307\u793A\u724C\uFF0C\u8BF7\u6CE8\u610F\u5B89\u5168",userId:0}]}},updated(){this.scrollToBottom()},computed:{windowHeight(){return this.rpxTopx(uni.getSystemInfoSync().windowHeight)},inputHeight(){return 177}},onLoad(){},onUnload(){uni.offKeyboardHeightChange()},methods:{focus(){this.scrollToBottom()},blur(){this.scrollToBottom()},rpxTopx(e){let r=750/wx.getSystemInfoSync().windowWidth*Number(e);return Math.floor(r)},sendHeight(){setTimeout(()=>{let e=uni.createSelectorQuery();e.select(".send-msg").boundingClientRect(),e.exec(t=>{this.bottomHeight=this.rpxTopx(t[0].height)})},10)},scrollToBottom(e){setTimeout(()=>{let t=uni.createSelectorQuery().in(this);t.select("#scrollview").boundingClientRect(),t.select("#msglistview").boundingClientRect(),t.exec(r=>{r[1].height>r[0].height&&(this.scrollTop=this.rpxTopx(r[1].height-r[0].height))})},15)},handleSend(){a("log","at components/cover-chat/cover-chat.vue:210","Here")}}};function N(e,t,r,c,n,s){let l=g((0,o.resolveDynamicComponent)("micphone"),B);return(0,o.openBlock)(),(0,o.createElementBlock)("view",{class:"chat",renderWhole:!0},[(0,o.createElementVNode)("scroll-view",{style:(0,o.normalizeStyle)({height:`${s.windowHeight-s.inputHeight}rpx`}),id:"scrollview",scrollY:"true",scrollTop:n.scrollTop,class:"scroll-view"},[(0,o.createElementVNode)("view",{id:"msglistview",class:"chat-body"},[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(n.msgList,(d,y)=>((0,o.openBlock)(),(0,o.createElementBlock)("view",{key:y},[d.userContent!=""?((0,o.openBlock)(),(0,o.createElementBlock)("view",{key:0,class:"item self"},[(0,o.createElementVNode)("view",{class:"content right"},[(0,o.createElementVNode)("u-text",null,(0,o.toDisplayString)(d.userContent),1)])])):(0,o.createCommentVNode)("",!0),d.botContent!=""?((0,o.openBlock)(),(0,o.createElementBlock)("view",{key:1,class:"item Ai"},[(0,o.createElementVNode)("view",{class:"content left"},[(0,o.createElementVNode)("u-text",null,(0,o.toDisplayString)(d.botContent),1)])])):(0,o.createCommentVNode)("",!0)]))),128))])],12,["scrollTop"]),(0,o.createElementVNode)("view",{class:"chat-bottom"},[(0,o.createVNode)(l,{StopHandler:s.handleSend},null,8,["StopHandler"])])])}var D=h(A,[["render",N],["styles",[L]]]),z={"pengke-camera":{"":{justifyContent:"center",alignItems:"center"}},chat:{".pengke-camera ":{position:"absolute",left:0,bottom:0,zIndex:98,alignItems:"center",justifyContent:"center"}},coverchat:{".pengke-camera .chat ":{zIndex:99}}},i=null,q={data(){return{poenCarmeInterval:null,aspect:"2:3",windowWidth:"",windowHeight:"",camerastate:!1,livePusher:null,snapshotsrc:null}},onLoad(e){i=this,this.initCamera()},onUnload(){uni.offKeyboardHeightChange()},onReady(){this.livePusher=uni.createLivePusherContext("livePusher",this),this.startPreview(),this.poenCarme()},methods:{poenCarme(){plus.os.name=="Android"&&(this.poenCarmeInterval=setInterval(function(){a("log","at pages/test-camera/cover_nvue.nvue:64",i.camerastate),i.camerastate||i.startPreview()},2500))},initCamera(){uni.getSystemInfo({success:function(e){i.windowWidth=e.windowWidth,i.windowHeight=e.windowHeight;let t=i.aliquot(i.windowWidth,i.windowHeight);i.aspect=i.windowWidth/t+":"+i.windowHeight/t}})},aliquot(e,t){return e%t==0?t:this.aliquot(t,e%t)},startPreview(){this.livePusher.startPreview({success:e=>{a("log","at pages/test-camera/cover_nvue.nvue:93",e)}})},stopPreview(){this.livePusher.stopPreview({success:e=>{i.camerastate=!1}})},statechange(e){a("log","at pages/test-camera/cover_nvue.nvue:110",e),e.detail.code==1007?i.camerastate=!0:e.detail.code==-1301&&(i.camerastate=!1)},back(){uni.navigateBack()},snapshot(){uni.vibrateShort({success:function(){a("log","at pages/test-camera/cover_nvue.nvue:129","success")}}),this.livePusher.snapshot({success:e=>{i.snapshotsrc=e.message.tempImagePath,i.stopPreview(),i.setImage(),uni.navigateBack()}})},flip(){this.livePusher.switchCamera()},setImage(){let e=getCurrentPages();e[e.length-2].$vm.setImage({path:i.snapshotsrc})}}};function E(e,t,r,c,n,s){let l=g((0,o.resolveDynamicComponent)("cover-chat"),D);return(0,o.openBlock)(),(0,o.createElementBlock)("scroll-view",{scrollY:!0,showScrollbar:!0,enableBackToTop:!0,bubble:"true",style:{flexDirection:"column"}},[(0,o.createElementVNode)("view",{class:"pengke-camera",style:(0,o.normalizeStyle)({width:n.windowWidth,height:n.windowHeight})},[(0,o.createElementVNode)("live-pusher",{id:"livePusher",ref:"livePusher",class:"livePusher",mode:"FHD",beauty:"0",whiteness:"0",aspect:n.aspect,minBitrate:"1000",audioQuality:"16KHz",devicePosition:"back",autoFocus:!0,muted:!0,enableCamera:!0,enableMic:!1,zoom:!1,onStatechange:t[0]||(t[0]=(...d)=>s.statechange&&s.statechange(...d)),style:(0,o.normalizeStyle)({width:n.windowWidth,height:n.windowHeight})},null,44,["aspect"]),(0,o.createElementVNode)("view",{class:"chat",style:(0,o.normalizeStyle)({width:n.windowWidth,height:n.windowHeight})},[(0,o.createElementVNode)("cover-view",{class:"coverchat",style:(0,o.normalizeStyle)({width:n.windowWidth,height:n.windowHeight})},[(0,o.createVNode)(l)],4)],4)],4)])}var u=h(q,[["render",E],["styles",[z]]]);var f=plus.webview.currentWebview();if(f){let e=parseInt(f.id),t="pages/test-camera/cover_nvue",r={};try{r=JSON.parse(f.__query__)}catch(n){}u.mpType="page";let c=Vue.createPageApp(u,{$store:getApp({allowDefault:!0}).$store,__pageId:e,__pagePath:t,__pageQuery:r});c.provide("__globalStyles",Vue.useCssStyles([...__uniConfig.styles,...u.styles||[]])),c.mount("#root")}})();
