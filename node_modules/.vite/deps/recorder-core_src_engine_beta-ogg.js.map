{
  "version": 3,
  "sources": ["../../recorder-core/src/engine/beta-ogg.js"],
  "sourcesContent": ["/*\r\nogg编码器，beta版，需带上src/engine/beta-ogg-engine.js引擎使用\r\nhttps://github.com/xiangyuecn/Recorder\r\n\r\n当然最佳推荐使用mp3、wav格式，代码也是优先照顾这两种格式\r\n浏览器支持情况\r\nhttps://developer.mozilla.org/en-US/docs/Web/HTML/Supported_media_formats\r\n*/\r\n(function(factory){\r\n\tvar browser=typeof window==\"object\" && !!window.document;\r\n\tvar win=browser?window:Object; //非浏览器环境，Recorder挂载在Object下面\r\n\tvar rec=win.Recorder,ni=rec.i18n;\r\n\tfactory(rec,ni,ni.$T,browser);\r\n}(function(Recorder,i18n,$T,isBrowser){\r\n\"use strict\";\r\n\r\nRecorder.prototype.enc_ogg={\r\n\tstable:true,takeEC:\"slow\"\r\n\t,getTestMsg:function(){\r\n\t\treturn $T(\"O8Gn::Ogg Vorbis，比特率取值16-100kbps，采样率取值无限制\");\r\n\t}\r\n};\r\n\r\nvar ImportEngineErr=function(){\r\n\treturn $T.G(\"NeedImport-2\",[\"beta-ogg.js\",\"src/engine/beta-ogg-engine.js\"]);\r\n};\r\n//是否支持web worker\r\nvar HasWebWorker=isBrowser && typeof Worker==\"function\";\r\n\r\n\r\n//*******标准UI线程转码支持函数************\r\n\r\nRecorder.prototype.ogg=function(res,True,False){\r\n\t\tvar This=this,set=This.set,size=res.length,bitRate=set.bitRate;\r\n\t\tif(!Recorder.OggVorbisEncoder){\r\n\t\t\tFalse(ImportEngineErr()); return;\r\n\t\t};\r\n\t\t\r\n\t\t//优先采用worker编码，非worker时用老方法提供兼容\r\n\t\tif(HasWebWorker){\r\n\t\t\tvar ctx=This.ogg_start(set);\r\n\t\t\tif(ctx){\r\n\t\t\t\tif(ctx.isW){\r\n\t\t\t\t\tThis.ogg_encode(ctx,res);\r\n\t\t\t\t\tThis.ogg_complete(ctx,True,False,1);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tThis.ogg_stop(ctx);\r\n\t\t\t};\r\n\t\t};\r\n\t\t\r\n\t\t\r\n\t\tvar bitV=GetBitRate(bitRate);\r\n\t\tset.bitRate=bitV.bitRate;\r\n\t\t\r\n\t\tvar ogg = new Recorder.OggVorbisEncoder(set.sampleRate, 1, bitV.val);\r\n\t\t\r\n\t\tvar blockSize=set.sampleRate;\r\n\t\tvar memory=new Uint8Array(500000), mOffset=0;\r\n\t\t\r\n\t\tvar idx=0;\r\n\t\tvar run=function(){\r\n\t\t\ttry{\r\n\t\t\t\tif(idx<size){\r\n\t\t\t\t\tvar buf=ogg.encode([res.subarray(idx,idx+blockSize)]);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar buf=ogg.flush();\r\n\t\t\t\t};\r\n\t\t\t}catch(e){ //精简代码调用了abort\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t\tFalse(\"Ogg Encoder: \"+e.message);\r\n\t\t\t\treturn;\r\n\t\t\t};\r\n\t\t\tif(buf.length>0){\r\n\t\t\t\tvar bufLen=buf.length;\r\n\t\t\t\tif(mOffset+bufLen>memory.length){\r\n\t\t\t\t\tvar tmp=new Uint8Array(memory.length+Math.max(500000,bufLen));\r\n\t\t\t\t\ttmp.set(memory.subarray(0, mOffset));\r\n\t\t\t\t\tmemory=tmp;\r\n\t\t\t\t}\r\n\t\t\t\tmemory.set(buf,mOffset);\r\n\t\t\t\tmOffset+=bufLen;\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tif(idx<size){\r\n\t\t\t\tidx+=blockSize;\r\n\t\t\t\tsetTimeout(run);//尽量避免卡ui\r\n\t\t\t}else{\r\n\t\t\t\tTrue(memory.buffer.slice(0,mOffset),\"audio/ogg\");\r\n\t\t\t};\r\n\t\t};\r\n\t\trun();\r\n\t}\r\n\r\n\r\n//********边录边转码(Worker)支持函数，如果提供就代表可能支持，否则只支持标准转码*********\r\n\r\n//全局共享一个Worker，后台串行执行。如果每次都开一个新的，编码速度可能会慢很多，可能是浏览器运行缓存的因素，并且可能瞬间产生多个并行操作占用大量cpu\r\nvar oggWorker;\r\nRecorder.BindDestroy(\"oggWorker\",function(){\r\n\tif(oggWorker){\r\n\t\tRecorder.CLog(\"oggWorker Destroy\");\r\n\t\toggWorker.terminate();\r\n\t\toggWorker=null;\r\n\t};\r\n});\r\n\r\n\r\nRecorder.prototype.ogg_envCheck=function(envInfo,set){//检查环境下配置是否可用\r\n\tvar errMsg=\"\";\r\n\t//需要实时编码返回数据，此时需要检查是否可实时编码\r\n\tif(set.takeoffEncodeChunk){\r\n\t\tif(!newContext()){//浏览器不能创建实时编码环境\r\n\t\t\terrMsg=$T(\"5si6::当前浏览器版本太低，无法实时处理\");\r\n\t\t};\r\n\t};\r\n\tif(!errMsg && !Recorder.OggVorbisEncoder){\r\n\t\terrMsg=ImportEngineErr();\r\n\t};\r\n\treturn errMsg;\r\n};\r\nRecorder.prototype.ogg_start=function(set){//如果返回null代表不支持\r\n\treturn newContext(set);\r\n};\r\nvar openList={id:0};\r\nvar newContext=function(setOrNull,_badW){\r\n\t//独立运行的函数，scope.wkScope worker.onmessage 字符串会被替换\r\n\tvar run=function(e){\r\n\t\tvar ed=e.data;\r\n\t\tvar wk_ctxs=scope.wkScope.wk_ctxs;\r\n\t\tvar wk_OggEnc=scope.wkScope.wk_OggEnc;\r\n\t\t\r\n\t\tvar cur=wk_ctxs[ed.id];\r\n\t\tif(ed.action==\"init\"){\r\n\t\t\twk_ctxs[ed.id]={\r\n\t\t\t\ttakeoff:ed.takeoff\r\n\t\t\t\t\r\n\t\t\t\t,pcmSize:0\r\n\t\t\t\t,memory:new Uint8Array(500000), mOffset:0\r\n\t\t\t\t,encObj:new wk_OggEnc(ed.sampleRate, 1, ed.bitVv)\r\n\t\t\t};\r\n\t\t}else if(!cur){\r\n\t\t\treturn;\r\n\t\t};\r\n\t\tvar addBytes=function(buf){\r\n\t\t\tvar bufLen=buf.length;\r\n\t\t\tif(cur.mOffset+bufLen>cur.memory.length){\r\n\t\t\t\tvar tmp=new Uint8Array(cur.memory.length+Math.max(500000,bufLen));\r\n\t\t\t\ttmp.set(cur.memory.subarray(0, cur.mOffset));\r\n\t\t\t\tcur.memory=tmp;\r\n\t\t\t}\r\n\t\t\tcur.memory.set(buf,cur.mOffset);\r\n\t\t\tcur.mOffset+=bufLen;\r\n\t\t};\r\n\t\t\r\n\t\tswitch(ed.action){\r\n\t\tcase \"stop\":\r\n\t\t\tcur.encObj=null;\r\n\t\t\tdelete wk_ctxs[ed.id];\r\n\t\t\tbreak;\r\n\t\tcase \"encode\":\r\n\t\t\tcur.pcmSize+=ed.pcm.length;\r\n\t\t\ttry{\r\n\t\t\t\tvar buf=cur.encObj.encode([ed.pcm]);\r\n\t\t\t}catch(e){ //精简代码调用了abort\r\n\t\t\t\tcur.err=e;\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t};\r\n\t\t\tif(buf && buf.length>0){\r\n\t\t\t\tif(cur.takeoff){\r\n\t\t\t\t\tworker.onmessage({action:\"takeoff\",id:ed.id,chunk:buf});\r\n\t\t\t\t}else{\r\n\t\t\t\t\taddBytes(buf);\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t\tbreak;\r\n\t\tcase \"complete\":\r\n\t\t\ttry{\r\n\t\t\t\tvar buf=cur.encObj.flush();\r\n\t\t\t}catch(e){ //精简代码调用了abort\r\n\t\t\t\tcur.err=e;\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t};\r\n\t\t\tif(buf && buf.length>0){\r\n\t\t\t\tif(cur.takeoff){\r\n\t\t\t\t\tworker.onmessage({action:\"takeoff\",id:ed.id,chunk:buf});\r\n\t\t\t\t}else{\r\n\t\t\t\t\taddBytes(buf);\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t\tif(cur.err){\r\n\t\t\t\tworker.onmessage({action:ed.action,id:ed.id\r\n\t\t\t\t\t,err:\"Ogg Encoder: \"+cur.err.message});\r\n\t\t\t\tbreak;\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tworker.onmessage({\r\n\t\t\t\taction:ed.action\r\n\t\t\t\t,id:ed.id\r\n\t\t\t\t,blob:cur.memory.buffer.slice(0,cur.mOffset)\r\n\t\t\t});\r\n\t\t\tbreak;\r\n\t\t};\r\n\t};\r\n\t\r\n\tvar initOnMsg=function(isW){\r\n\t\tworker.onmessage=function(e){\r\n\t\t\tvar data=e; if(isW)data=e.data;\r\n\t\t\tvar ctx=openList[data.id];\r\n\t\t\tif(ctx){\r\n\t\t\t\tif(data.action==\"takeoff\"){\r\n\t\t\t\t\t//取走实时生成的ogg数据\r\n\t\t\t\t\tctx.set.takeoffEncodeChunk(new Uint8Array(data.chunk.buffer));\r\n\t\t\t\t}else{\r\n\t\t\t\t\t//complete\r\n\t\t\t\t\tctx.call&&ctx.call(data);\r\n\t\t\t\t\tctx.call=null;\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t};\r\n\t};\r\n\tvar initCtx=function(){\r\n\t\tvar ctx={worker:worker,set:setOrNull};\r\n\t\tif(setOrNull){\r\n\t\t\tctx.id=++openList.id;\r\n\t\t\topenList[ctx.id]=ctx;\r\n\t\t\t\r\n\t\t\tvar bitV=GetBitRate(setOrNull.bitRate);\r\n\t\t\tsetOrNull.bitRate=bitV.bitRate;\r\n\t\t\t\r\n\t\t\tvar takeoff=!!setOrNull.takeoffEncodeChunk;\r\n\t\t\tif(takeoff){\r\n\t\t\t\tRecorder.CLog($T(\"R8yz::takeoffEncodeChunk接管OggVorbis编码器输出的二进制数据，Ogg由数据页组成，一页包含多帧音频数据（含几秒的音频，一页数据无法单独解码和播放），此编码器每次输出都是完整的一页数据，因此实时性会比较低；在合并成完整ogg文件时，必须将输出的所有数据合并到一起，否则可能无法播放，不支持截取中间一部分单独解码和播放\"),3);\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tworker.postMessage({\r\n\t\t\t\taction:\"init\"\r\n\t\t\t\t,id:ctx.id\r\n\t\t\t\t,sampleRate:setOrNull.sampleRate\r\n\t\t\t\t,bitRate:setOrNull.bitRate, bitVv:bitV.val\r\n\t\t\t\t,takeoff:takeoff\r\n\t\t\t\t\r\n\t\t\t\t,x:new Int16Array(5)//低版本浏览器不支持序列化TypedArray\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\tworker.postMessage({\r\n\t\t\t\tx:new Int16Array(5)//低版本浏览器不支持序列化TypedArray\r\n\t\t\t});\r\n\t\t};\r\n\t\treturn ctx;\r\n\t};\r\n\tvar scope,worker=oggWorker;\r\n\t\r\n\t//非浏览器，不支持worker，或者开启失败，使用UI线程处理\r\n\tif(_badW || !HasWebWorker){\r\n\t\tRecorder.CLog($T(\"hB9D::当前环境不支持Web Worker，OggVorbis实时编码器运行在主线程中\"),3);\r\n\t\tworker={ postMessage:function(ed){ run({data:ed}); } };\r\n\t\tscope={wkScope:{\r\n\t\t\twk_ctxs:{}, wk_OggEnc:Recorder.OggVorbisEncoder\r\n\t\t}};\r\n\t\tinitOnMsg();\r\n\t\treturn initCtx();\r\n\t};\r\n\t\r\n\ttry{\r\n\t\tif(!worker){\r\n\t\t\t//创建一个新Worker\r\n\t\t\tvar onmsg=(run+\"\").replace(/[\\w\\$]+\\.onmessage/g,\"self.postMessage\");\r\n\t\t\tonmsg=onmsg.replace(/[\\w\\$]+\\.wkScope/g,\"wkScope\");\r\n\t\t\tvar jsCode=\");self.onmessage=\"+onmsg;\r\n\t\t\tjsCode+=\";var wkScope={ wk_ctxs:{},wk_OggEnc:Create() };\";\r\n\t\t\tif(Recorder.OggVorbisEncoder.Module.StaticSeed){\r\n\t\t\t\tjsCode+=\"wkScope.wk_OggEnc.Module.StaticSeed=true;\";\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tvar engineCode=Recorder.OggVorbisEncoder.Create.toString();\r\n\t\t\tvar url=(window.URL||webkitURL).createObjectURL(new Blob([\"var Create=(\",engineCode,jsCode], {type:\"text/javascript\"}));\r\n\t\t\t\r\n\t\t\tworker=new Worker(url);\r\n\t\t\tsetTimeout(function(){\r\n\t\t\t\t(window.URL||webkitURL).revokeObjectURL(url);//必须要释放，不然每次调用内存都明显泄露内存\r\n\t\t\t},10000);//chrome 83 file协议下如果直接释放，将会使WebWorker无法启动\r\n\t\t\tinitOnMsg(1);\r\n\t\t};\r\n\t\t\r\n\t\tvar ctx=initCtx(); ctx.isW=1;\r\n\t\toggWorker=worker;\r\n\t\treturn ctx;\r\n\t}catch(e){//出错了就不要提供了\r\n\t\tworker&&worker.terminate();\r\n\t\tconsole.error(e);\r\n\t\treturn newContext(setOrNull, 1);//切换到UI线程处理\r\n\t};\r\n};\r\nRecorder.prototype.ogg_stop=function(startCtx){\r\n\tif(startCtx&&startCtx.worker){\r\n\t\tstartCtx.worker.postMessage({\r\n\t\t\taction:\"stop\"\r\n\t\t\t,id:startCtx.id\r\n\t\t});\r\n\t\tstartCtx.worker=null;\r\n\t\tdelete openList[startCtx.id];\r\n\t\t\r\n\t\t//疑似泄露检测 排除id\r\n\t\tvar opens=-1;\r\n\t\tfor(var k in openList){\r\n\t\t\topens++;\r\n\t\t};\r\n\t\tif(opens){\r\n\t\t\tRecorder.CLog($T(\"oTiy::ogg worker剩{1}个未stop\",0,opens),3);\r\n\t\t};\r\n\t};\r\n};\r\nRecorder.prototype.ogg_encode=function(startCtx,pcm){\r\n\tif(startCtx&&startCtx.worker){\r\n\t\tstartCtx.worker.postMessage({\r\n\t\t\taction:\"encode\"\r\n\t\t\t,id:startCtx.id\r\n\t\t\t,pcm:pcm\r\n\t\t});\r\n\t};\r\n};\r\nRecorder.prototype.ogg_complete=function(startCtx,True,False,autoStop){\r\n\tvar This=this;\r\n\tif(startCtx&&startCtx.worker){\r\n\t\tstartCtx.call=function(data){\r\n\t\t\tif(autoStop){\r\n\t\t\t\tThis.ogg_stop(startCtx);\r\n\t\t\t};\r\n\t\t\tif(data.err){\r\n\t\t\t\tFalse(data.err);\r\n\t\t\t}else{\r\n\t\t\t\tTrue(data.blob,\"audio/ogg\");\r\n\t\t\t};\r\n\t\t};\r\n\t\tstartCtx.worker.postMessage({\r\n\t\t\taction:\"complete\"\r\n\t\t\t,id:startCtx.id\r\n\t\t});\r\n\t}else{\r\n\t\tFalse($T(\"dIpw::ogg编码器未start\"));\r\n\t};\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n/* 编码输出测试，半天才输出一段数据\r\nvar ogg = new Recorder.OggVorbisEncoder(16000, 1, -0.1);\r\nfor(var i=0;i<10*10;i++){v=ogg.encode([new Array(1600).fill().map(a=>~~(Math.random()*0x7fff))]).length; if(v)console.log(i,v)}\r\nconsole.log(\"flush\");ogg.flush().length;\r\n*/\r\n\r\n//转换比特率成质量数值\r\nvar GetBitRate=function(bitRate){\r\n\tbitRate=Math.min(Math.max(bitRate,16),100);\r\n\t//取值-0.1-1，实际输出16-100kbps\r\n\tvar val=Math.max(1.1*(bitRate-16)/(100-16)-0.1, -0.1);\r\n\treturn {bitRate:bitRate,val:val};\r\n};\r\n\r\n}));"],
  "mappings": "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",
  "names": ["buf", "e", "ctx"]
}
